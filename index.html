<!DOCTYPE html>

<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CT Fair Rent Commission Case Prep Tool</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

```
    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        color: #333;
    }

    .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
    }

    .header {
        text-align: center;
        margin-bottom: 30px;
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        border-radius: 20px;
        padding: 20px;
        border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .header h1 {
        color: white;
        font-size: 2.5em;
        margin-bottom: 10px;
        text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    }

    .header p {
        color: rgba(255, 255, 255, 0.9);
        font-size: 1.2em;
    }

    .main-content {
        display: grid;
        grid-template-columns: 1fr 2fr;
        gap: 20px;
        margin-bottom: 30px;
    }

    .sidebar {
        background: rgba(255, 255, 255, 0.95);
        border-radius: 15px;
        padding: 20px;
        box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .main-panel {
        background: rgba(255, 255, 255, 0.95);
        border-radius: 15px;
        padding: 30px;
        box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .nav-btn {
        display: block;
        width: 100%;
        padding: 15px;
        margin: 10px 0;
        border: none;
        border-radius: 10px;
        background: linear-gradient(45deg, #667eea, #764ba2);
        color: white;
        font-size: 16px;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .nav-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    }

    .nav-btn.active {
        background: linear-gradient(45deg, #764ba2, #667eea);
        transform: scale(1.05);
    }

    .section {
        display: none;
    }

    .section.active {
        display: block;
        animation: fadeIn 0.5s ease-in;
    }

    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
    }

    .form-group {
        margin-bottom: 20px;
    }

    label {
        display: block;
        margin-bottom: 5px;
        font-weight: bold;
        color: #555;
    }

    input, textarea, select {
        width: 100%;
        padding: 12px;
        border: 2px solid #ddd;
        border-radius: 8px;
        font-size: 16px;
        transition: border-color 0.3s ease;
    }

    input:focus, textarea:focus, select:focus {
        outline: none;
        border-color: #667eea;
    }

    textarea {
        resize: vertical;
        min-height: 100px;
    }

    .btn {
        background: linear-gradient(45deg, #667eea, #764ba2);
        color: white;
        padding: 12px 24px;
        border: none;
        border-radius: 8px;
        font-size: 16px;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    }

    .checklist {
        background: #f8f9fa;
        padding: 20px;
        border-radius: 10px;
        margin: 20px 0;
    }

    .checklist-item {
        display: flex;
        align-items: center;
        margin: 10px 0;
        padding: 10px;
        background: white;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .checklist-item input[type="checkbox"] {
        width: auto;
        margin-right: 10px;
    }

    .progress-bar {
        background: #e0e0e0;
        height: 20px;
        border-radius: 10px;
        overflow: hidden;
        margin: 20px 0;
    }

    .progress-fill {
        height: 100%;
        background: linear-gradient(45deg, #667eea, #764ba2);
        transition: width 0.3s ease;
    }

    .alert {
        padding: 15px;
        margin: 20px 0;
        border-radius: 8px;
        border-left: 4px solid #667eea;
        background: #e8f4ff;
    }

    .timeline {
        position: relative;
        margin: 20px 0;
    }

    .timeline-item {
        position: relative;
        padding: 20px;
        margin: 10px 0;
        background: white;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        border-left: 4px solid #667eea;
    }

    .document-list {
        background: #f8f9fa;
        padding: 20px;
        border-radius: 10px;
        margin: 20px 0;
    }

    .document-item {
        padding: 15px;
        margin: 10px 0;
        background: white;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .status-badge {
        padding: 5px 10px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: bold;
    }

    .status-needed {
        background: #ffebee;
        color: #c62828;
    }

    .status-uploaded {
        background: #e8f5e8;
        color: #2e7d32;
    }

    @media (max-width: 768px) {
        .main-content {
            grid-template-columns: 1fr;
        }
        
        .header h1 {
            font-size: 2em;
        }
    }
</style>
```

</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Connecticut Fair Rent Commission Case Prep Tool</h1>
            <p>Comprehensive case preparation for tenant rent disputes</p>
        </div>

```
    <div class="main-content">
        <div class="sidebar">
            <h3>Win Your FRC Case</h3>
            <button class="nav-btn active" onclick="showSection('basics')">1. Case Basics</button>
            <button class="nav-btn" onclick="showSection('documents')">2. Document Collection</button>
            <button class="nav-btn" onclick="showSection('timeline')">3. Timeline Builder</button>
            <button class="nav-btn" onclick="showSection('complaint')">4. Complaint Form</button>
            <button class="nav-btn" onclick="showSection('preparation')">5. Hearing Preparation</button>
            <button class="nav-btn" onclick="showSection('report')">6. Case Report</button>
            <button class="nav-btn" onclick="showSection('resources')">7. Resources</button>
            
            <div style="margin-top: 30px;">
                <h4>Case Progress</h4>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressBar" style="width: 0%"></div>
                </div>
                <p id="progressText">0% Complete</p>
            </div>
        </div>

        <div class="main-panel">
            <!-- Case Basics Section -->
            <div id="basics" class="section active">
                <h2>Case Basics</h2>
                <div class="alert">
                    <strong>Important:</strong> Fair Rent Commissions exist in Connecticut towns with 25,000+ residents. Check if your town has an FRC before proceeding.
                </div>
                
                <div class="form-group">
                    <label for="tenantName">Tenant Name</label>
                    <input type="text" id="tenantName" placeholder="Enter your full name">
                </div>
                
                <div class="form-group">
                    <label for="propertyAddress">Property Address</label>
                    <input type="text" id="propertyAddress" placeholder="Full address of rental property">
                </div>
                
                <div class="form-group">
                    <label for="landlordName">Landlord/Property Manager Name</label>
                    <input type="text" id="landlordName" placeholder="Name of landlord or property management company">
                </div>
                
                <div class="form-group">
                    <label for="currentRent">Current Monthly Rent</label>
                    <input type="number" id="currentRent" placeholder="1200">
                </div>
                
                <div class="form-group">
                    <label for="proposedRent">Proposed New Rent</label>
                    <input type="number" id="proposedRent" placeholder="1500">
                </div>
                
                <div class="form-group">
                    <label for="rentIncreaseDate">Effective Date of Rent Increase</label>
                    <input type="date" id="rentIncreaseDate">
                </div>
                
                <div class="form-group">
                    <label for="caseType">Type of Complaint</label>
                    <select id="caseType">
                        <option value="">Select complaint type</option>
                        <option value="excessive_increase">Excessive Rent Increase</option>
                        <option value="protected_tenant">Protected Tenant Rights</option>
                        <option value="habitability">Habitability Issues</option>
                        <option value="retaliation">Retaliation</option>
                    </select>
                </div>

                <!-- Financial Information for Hardship Analysis -->
                <h3 style="margin-top: 30px; color: #667eea;">Financial Information</h3>
                <div class="alert">
                    <strong>Note:</strong> This information helps calculate financial hardship and strengthen your case.
                </div>
                
                <div class="form-group">
                    <label for="monthlyIncome">Monthly Household Income (before taxes)</label>
                    <input type="number" id="monthlyIncome" placeholder="4000">
                </div>
                
                <div class="form-group">
                    <label for="monthlyExpenses">Other Monthly Expenses (utilities, food, transportation, etc.)</label>
                    <input type="number" id="monthlyExpenses" placeholder="1500">
                </div>
                
                <div class="form-group">
                    <label for="householdSize">Number of People in Household</label>
                    <input type="number" id="householdSize" placeholder="2" min="1">
                </div>
                
                <button class="btn" onclick="saveBasics()">Save Case Basics</button>
                
                <!-- Financial Hardship Analysis -->
                <div id="hardshipAnalysis" style="display: none; margin-top: 20px; padding: 20px; background: #f8f9fa; border-radius: 10px;">
                    <h4>Financial Hardship Analysis</h4>
                    <div id="hardshipResults"></div>
                </div>
            </div>

            <!-- Document Collection Section -->
            <div id="documents" class="section">
                <h2>Document Collection Checklist</h2>
                <p>Gather all necessary documents for your FRC case. Required documents vary by case type.</p>
                
                <div class="document-list">
                    <h3>Required Documents</h3>
                    <div class="document-item">
                        <div>
                            <strong>Current Lease Agreement</strong>
                            <p>Your signed lease showing current rent terms</p>
                        </div>
                        <div>
                            <span class="status-badge status-needed" id="lease-status">Needed</span>
                            <input type="file" id="lease-file" style="display: none;" onchange="updateDocStatus('lease')">
                            <button class="btn" onclick="document.getElementById('lease-file').click()">Upload</button>
                        </div>
                    </div>
                    
                    <div class="document-item">
                        <div>
                            <strong>Rent Increase Notice</strong>
                            <p>Official notice from landlord about rent increase</p>
                        </div>
                        <div>
                            <span class="status-badge status-needed" id="notice-status">Needed</span>
                            <input type="file" id="notice-file" style="display: none;" onchange="updateDocStatus('notice')">
                            <button class="btn" onclick="document.getElementById('notice-file').click()">Upload</button>
                        </div>
                    </div>
                    
                    <div class="document-item">
                        <div>
                            <strong>Proof of Current Rent Payments</strong>
                            <p>Bank statements, receipts, or payment records</p>
                        </div>
                        <div>
                            <span class="status-badge status-needed" id="payments-status">Needed</span>
                            <input type="file" id="payments-file" style="display: none;" onchange="updateDocStatus('payments')">
                            <button class="btn" onclick="document.getElementById('payments-file').click()">Upload</button>
                        </div>
                    </div>

                    <h3 style="margin-top: 30px;">Additional Supporting Documents</h3>
                    <div class="document-item">
                        <div>
                            <strong>Comparable Rent Research</strong>
                            <p>Documentation of similar units' rent in your area</p>
                        </div>
                        <div>
                            <span class="status-badge status-needed" id="comparables-status">Optional</span>
                            <input type="file" id="comparables-file" style="display: none;" onchange="updateDocStatus('comparables')">
                            <button class="btn" onclick="document.getElementById('comparables-file').click()">Upload</button>
                        </div>
                    </div>

                    <div class="document-item">
                        <div>
                            <strong>Building Code Violations</strong>
                            <p>Records of habitability issues or code violations</p>
                        </div>
                        <div>
                            <span class="status-badge status-needed" id="violations-status">Optional</span>
                            <input type="file" id="violations-file" style="display: none;" onchange="updateDocStatus('violations')">
                            <button class="btn" onclick="document.getElementById('violations-file').click()">Upload</button>
                        </div>
                    </div>

                    <div class="document-item">
                        <div>
                            <strong>Income Documentation</strong>
                            <p>Pay stubs, benefits statements, tax returns</p>
                        </div>
                        <div>
                            <span class="status-badge status-needed" id="income-status">Optional</span>
                            <input type="file" id="income-file" style="display: none;" onchange="updateDocStatus('income')">
                            <button class="btn" onclick="document.getElementById('income-file').click()">Upload</button>
                        </div>
                    </div>

                    <div class="document-item">
                        <div>
                            <strong>Communication Records</strong>
                            <p>Emails, letters, or texts with landlord about rent increase</p>
                        </div>
                        <div>
                            <span class="status-badge status-needed" id="communications-status">Optional</span>
                            <input type="file" id="communications-file" style="display: none;" onchange="updateDocStatus('communications')">
                            <button class="btn" onclick="document.getElementById('communications-file').click()">Upload</button>
                        </div>
                    </div>
                </div>

                <!-- Evidence Strength Analysis -->
                <div id="evidenceAnalysis" style="margin-top: 30px; padding: 20px; background: #f8f9fa; border-radius: 10px;">
                    <h3>Evidence Strength Analysis</h3>
                    <div class="progress-bar" style="margin: 15px 0;">
                        <div class="progress-fill" id="evidenceStrengthBar" style="width: 0%"></div>
                    </div>
                    <div id="evidenceStrengthText">Evidence Strength: 0%</div>
                    
                    <div id="evidenceRecommendations" style="margin-top: 15px;">
                        <h4>Recommendations to Strengthen Your Case:</h4>
                        <div id="recommendationsList"></div>
                    </div>
                    
                    <div id="missingRequired" style="margin-top: 15px; display: none;">
                        <h4 style="color: #c62828;">Missing Required Documents:</h4>
                        <div id="missingRequiredList"></div>
                    </div>
                </div>
            </div>

            <!-- Timeline Builder Section -->
            <div id="timeline" class="section">
                <h2>Case Timeline Builder</h2>
                <p>Create a chronological timeline of events related to your case.</p>
                
                <div class="form-group">
                    <label for="eventDate">Event Date</label>
                    <input type="date" id="eventDate">
                </div>
                
                <div class="form-group">
                    <label for="eventDescription">Event Description</label>
                    <textarea id="eventDescription" placeholder="Describe what happened on this date..."></textarea>
                </div>
                
                <button class="btn" onclick="addTimelineEvent()">Add Event</button>
                
                <div class="timeline" id="timelineContainer">
                    <!-- Timeline events will be added here -->
                </div>
            </div>

            <!-- Complaint Form Section -->
            <div id="complaint" class="section">
                <h2>Fair Rent Commission Complaint Form</h2>
                <p>Complete your formal complaint to submit to the Fair Rent Commission.</p>
                
                <div class="form-group">
                    <label for="complaintSummary">Complaint Summary</label>
                    <textarea id="complaintSummary" placeholder="Briefly describe your complaint and what you're seeking..."></textarea>
                </div>
                
                <div class="form-group">
                    <label for="rentIncrease">Rent Increase Details</label>
                    <textarea id="rentIncrease" placeholder="Describe the rent increase: amount, notice given, reasons provided by landlord..."></textarea>
                </div>
                
                <div class="form-group">
                    <label for="whyExcessive">Why is the increase excessive?</label>
                    <textarea id="whyExcessive" placeholder="Explain why you believe the rent increase is excessive or unreasonable..."></textarea>
                </div>
                
                <div class="form-group">
                    <label for="reliefSought">Relief Sought</label>
                    <textarea id="reliefSought" placeholder="What do you want the Fair Rent Commission to do? (e.g., reduce rent increase, maintain current rent, etc.)"></textarea>
                </div>
                
                <button class="btn" onclick="generateComplaint()">Generate Complaint Form</button>
                
                <div id="complaintOutput" style="display: none; margin-top: 20px; padding: 20px; background: #f8f9fa; border-radius: 10px;">
                    <h3>Generated Complaint</h3>
                    <div id="complaintText"></div>
                    <button class="btn" onclick="printComplaint()">Print Complaint</button>
                </div>
            </div>

            <!-- Hearing Preparation Section -->
            <div id="preparation" class="section">
                <h2>Hearing Preparation</h2>
                <p>Prepare for your Fair Rent Commission hearing with this comprehensive checklist.</p>
                
                <div class="checklist">
                    <h3>Pre-Hearing Checklist</h3>
                    <div class="checklist-item">
                        <input type="checkbox" id="prep1" onchange="updateProgress()">
                        <label for="prep1">Review all submitted documents and evidence</label>
                    </div>
                    <div class="checklist-item">
                        <input type="checkbox" id="prep2" onchange="updateProgress()">
                        <label for="prep2">Prepare opening statement (3-5 minutes)</label>
                    </div>
                    <div class="checklist-item">
                        <input type="checkbox" id="prep3" onchange="updateProgress()">
                        <label for="prep3">Organize evidence in chronological order</label>
                    </div>
                    <div class="checklist-item">
                        <input type="checkbox" id="prep4" onchange="updateProgress()">
                        <label for="prep4">Prepare list of key points to make</label>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="openingStatement">Opening Statement Draft</label>
                    <textarea id="openingStatement" placeholder="Draft your opening statement here. Keep it concise and focus on key facts..."></textarea>
                </div>
                
                <button class="btn" onclick="saveHearingPrep()">Save Hearing Preparation</button>
            </div>

            <!-- Case Report Section -->
            <div id="report" class="section">
                <h2>Case Report</h2>
                <p>Generate a comprehensive report of your case for submission to the Fair Rent Commission.</p>
                
                <div class="form-group">
                    <label for="reportTitle">Report Title</label>
                    <input type="text" id="reportTitle" placeholder="e.g., Rent Increase Dispute Report">
                </div>
                
                <div class="form-group">
                    <label for="reportSummary">Report Summary</label>
                    <textarea id="reportSummary" placeholder="A brief summary of the case, including key points and findings."></textarea>
                </div>
                
                <button class="btn" onclick="generateCaseReport()">Generate Case Report</button>
                
                <div id="caseReportOutput" style="display: none; margin-top: 20px; padding: 20px; background: #f8f9fa; border-radius: 10px;">
                    <h3>Generated Case Report</h3>
                    <div id="caseReportText"></div>
                    <button class="btn" onclick="printCaseReport()">Print Report</button>
                </div>
            </div>

            <!-- Resources Section -->
            <div id="resources" class="section">
                <h2>Resources & Information</h2>
                
                <div class="alert">
                    <strong>Legal Disclaimer:</strong> This tool provides general information only. For specific legal advice, consult with a qualified attorney.
                </div>
                
                <h3>Fair Rent Commission Process</h3>
                <div class="timeline">
                    <div class="timeline-item">
                        <strong>Step 1: File Complaint</strong>
                        <p>Submit written complaint to your local Fair Rent Commission within required timeframe.</p>
                    </div>
                    <div class="timeline-item">
                        <strong>Step 2: Investigation</strong>
                        <p>FRC staff reviews complaint and gathers necessary documentation.</p>
                    </div>
                    <div class="timeline-item">
                        <strong>Step 3: Public Hearing</strong>
                        <p>Formal hearing before FRC board of commissioners.</p>
                    </div>
                    <div class="timeline-item">
                        <strong>Step 4: Decision</strong>
                        <p>FRC issues written decision that is binding on both parties.</p>
                    </div>
                </div>
                
                <h3>Important Contacts</h3>
                <div class="document-list">
                    <div class="document-item">
                        <div>
                            <strong>Connecticut Department of Housing</strong>
                            <p>Find your local Fair Rent Commission</p>
                        </div>
                        <div>
                            <a href="https://portal.ct.gov/doh" target="_blank" class="btn">Visit Website</a>
                        </div>
                    </div>
                    <div class="document-item">
                        <div>
                            <strong>Connecticut Legal Aid</strong>
                            <p>Free legal assistance for qualifying tenants</p>
                        </div>
                        <div>
                            <a href="https://ctlawhelp.org" target="_blank" class="btn">Get Help</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    let caseData = {};
    let timelineEvents = [];
    let uploadedDocs = {};

    // Phase 1: LocalStorage persistence
    function saveToLocalStorage() {
        const appData = {
            caseData,
            timelineEvents,
            uploadedDocs,
            lastSaved: new Date().toISOString()
        };
        localStorage.setItem('frcCaseData', JSON.stringify(appData));
    }

    function loadFromLocalStorage() {
        const saved = localStorage.getItem('frcCaseData');
        if (saved) {
            const appData = JSON.parse(saved);
            caseData = appData.caseData || {};
            timelineEvents = appData.timelineEvents || [];
            uploadedDocs = appData.uploadedDocs || {};
            
            // Restore form data
            restoreFormData();
            renderTimeline();
            updateAllAnalysis();
        }
    }

    function restoreFormData() {
        // Restore basic case info
        if (caseData.tenantName) document.getElementById('tenantName').value = caseData.tenantName;
        if (caseData.propertyAddress) document.getElementById('propertyAddress').value = caseData.propertyAddress;
        if (caseData.landlordName) document.getElementById('landlordName').value = caseData.landlordName;
        if (caseData.currentRent) document.getElementById('currentRent').value = caseData.currentRent;
        if (caseData.proposedRent) document.getElementById('proposedRent').value = caseData.proposedRent;
        if (caseData.rentIncreaseDate) document.getElementById('rentIncreaseDate').value = caseData.rentIncreaseDate;
        if (caseData.caseType) document.getElementById('caseType').value = caseData.caseType;
        
        // Restore financial info
        if (caseData.monthlyIncome) document.getElementById('monthlyIncome').value = caseData.monthlyIncome;
        if (caseData.monthlyExpenses) document.getElementById('monthlyExpenses').value = caseData.monthlyExpenses;
        if (caseData.householdSize) document.getElementById('householdSize').value = caseData.householdSize;
        
        // Restore document status
        for (const [docType, uploaded] of Object.entries(uploadedDocs)) {
            if (uploaded) {
                const statusElement = document.getElementById(docType + '-status');
                if (statusElement) {
                    statusElement.textContent = 'Uploaded';
                    statusElement.classList.remove('status-needed');
                    statusElement.classList.add('status-uploaded');
                }
            }
        }
    }

    // Phase 1: Evidence Strength Analyzer
    class EvidenceAnalyzer {
        constructor() {
            this.evidenceTypes = {
                'lease': { weight: 10, required: true, name: 'Current Lease Agreement' },
                'notice': { weight: 10, required: true, name: 'Rent Increase Notice' },
                'payments': { weight: 8, required: true, name: 'Proof of Current Rent Payments' },
                'comparables': { weight: 9, required: false, name: 'Comparable Rent Research' },
                'violations': { weight: 8, required: false, name: 'Building Code Violations' },
                'income': { weight: 7, required: false, name: 'Income Documentation' },
                'communications': { weight: 6, required: false, name: 'Communication Records' }
            };
        }
        
        analyzeEvidenceStrength(uploadedEvidence, caseData) {
            let totalScore = 0;
            let maxPossibleScore = 0;
            let missingRequired = [];
            let recommendations = [];
            
            for (const [type, config] of Object.entries(this.evidenceTypes)) {
                maxPossibleScore += config.weight;
                
                if (uploadedEvidence[type]) {
                    totalScore += config.weight;
                } else {
                    if (config.required) {
                        missingRequired.push(config.name);
                    } else {
                        recommendations.push(this.getRecommendation(type, config.name, caseData));
                    }
                }
            }
            
            return {
                strength: Math.round((totalScore / maxPossibleScore) * 100),
                missingRequired,
                recommendations: recommendations.filter(r => r),
                score: `${totalScore}/${maxPossibleScore}`
            };
        }
        
        getRecommendation(type, name, caseData) {
            const recommendations = {
                'comparables': 'Research similar rental units in your area to prove the increase is above market rate.',
                'violations': 'Document any habitability issues or code violations to strengthen your case.',
                'income': 'Provide income documentation to demonstrate financial hardship.',
                'communications': 'Include all correspondence with your landlord about the rent increase.'
            };
            
            return recommendations[type] ? { type, name, text: recommendations[type] } : null;
        }
    }

    // Phase 1: Financial Hardship Analyzer
    class FinancialHardshipAnalyzer {
        constructor(caseData) {
            this.income = parseFloat(caseData.monthlyIncome) || 0;
            this.currentRent = parseFloat(caseData.currentRent) || 0;
            this.proposedRent = parseFloat(caseData.proposedRent) || 0;
            this.otherExpenses = parseFloat(caseData.monthlyExpenses) || 0;
            this.householdSize = parseInt(caseData.householdSize) || 1;
        }
        
        calculateHardship() {
            if (!this.income || !this.currentRent || !this.proposedRent) {
                return null;
            }
            
            const currentRentBurden = (this.currentRent / this.income) * 100;
            const proposedRentBurden = (this.proposedRent / this.income) * 100;
            const increase = this.proposedRent - this.currentRent;
            const increasePercent = ((this.proposedRent - this.currentRent) / this.currentRent) * 100;
            
            return {
                currentBurden: currentRentBurden.toFixed(1),
                proposedBurden: proposedRentBurden.toFixed(1),
                exceedsAffordable: proposedRentBurden > 30,
                exceedsSeverelyBurdened: proposedRentBurden > 50,
                annualIncrease: increase * 12,
                increasePercent: increasePercent.toFixed(1),
                displacementRisk: this.assessDisplacementRisk(),
                recommendations: this.getRecommendations(proposedRentBurden, increasePercent)
            };
        }
        
        assessDisplacementRisk() {
            const disposableIncome = this.income - this.currentRent - this.otherExpenses;
            const increaseAmount = this.proposedRent - this.currentRent;
            
            if (increaseAmount > disposableIncome) return 'High';
            if (increaseAmount > disposableIncome * 0.7) return 'Medium';
            return 'Low';
        }
        
        getRecommendations(proposedBurden, increasePercent) {
            const recs = [];
            
            if (proposedBurden > 30) {
                recs.push('Rent burden exceeds HUD affordability standards (30% of income)');
            }
            if (proposedBurden > 50) {
                recs.push('Severely rent-burdened - risk of displacement is high');
            }
            if (increasePercent > 10) {
                recs.push('Rent increase percentage is significantly above typical annual increases');
            }
            
            return recs;
        }
    }

    function showSection(sectionId) {
        // Hide all sections
        document.querySelectorAll('.section').forEach(section => {
            section.classList.remove('active');
        });
        
        // Remove active class from all buttons
        document.querySelectorAll('.nav-btn').forEach(btn => {
            btn.classList.remove('active');
        });
        
        // Show selected section
        document.getElementById(sectionId).classList.add('active');
        
        // Add active class to clicked button
        event.target.classList.add('active');
        
        // Update progress and analysis
        updateAllAnalysis();
    }

    function saveBasics() {
        // Save basic case info
        caseData.tenantName = document.getElementById('tenantName').value;
        caseData.propertyAddress = document.getElementById('propertyAddress').value;
        caseData.landlordName = document.getElementById('landlordName').value;
        caseData.currentRent = document.getElementById('currentRent').value;
        caseData.proposedRent = document.getElementById('proposedRent').value;
        caseData.rentIncreaseDate = document.getElementById('rentIncreaseDate').value;
        caseData.caseType = document.getElementById('caseType').value;
        
        // Save financial info
        caseData.monthlyIncome = document.getElementById('monthlyIncome').value;
        caseData.monthlyExpenses = document.getElementById('monthlyExpenses').value;
        caseData.householdSize = document.getElementById('householdSize').value;
        
        // Perform financial hardship analysis
        performFinancialAnalysis();
        
        // Save to localStorage
        saveToLocalStorage();
        
        alert('Case basics saved successfully!');
        updateAllAnalysis();
        showSection('documents'); // Auto-advance to documents
    }

    function performFinancialAnalysis() {
        const analyzer = new FinancialHardshipAnalyzer(caseData);
        const analysis = analyzer.calculateHardship();
        
        if (analysis) {
            const hardshipDiv = document.getElementById('hardshipAnalysis');
            const resultsDiv = document.getElementById('hardshipResults');
            
            resultsDiv.innerHTML = `
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 15px;">
                    <div>
                        <strong>Current Rent Burden:</strong> ${analysis.currentBurden}%<br>
                        <strong>Proposed Rent Burden:</strong> ${analysis.proposedBurden}%<br>
                        <strong>Annual Increase:</strong> $${analysis.annualIncrease.toLocaleString()}
                    </div>
                    <div>
                        <strong>Increase Percentage:</strong> ${analysis.increasePercent}%<br>
                        <strong>Displacement Risk:</strong> ${analysis.displacementRisk}<br>
                        <strong>Exceeds HUD Standard:</strong> ${analysis.exceedsAffordable ? 'Yes' : 'No'}
                    </div>
                </div>
                ${analysis.recommendations.length > 0 ? `
                    <div class="alert">
                        <strong>Financial Impact Analysis:</strong><br>
                        ${analysis.recommendations.map(rec => `• ${rec}`).join('<br>')}
                    </div>
                ` : ''}
            `;
            
            hardshipDiv.style.display = 'block';
        }
    }

    function updateDocStatus(docType) {
        const statusElement = document.getElementById(docType + '-status');
        statusElement.textContent = 'Uploaded';
        statusElement.classList.remove('status-needed');
        statusElement.classList.add('status-uploaded');
        
        uploadedDocs[docType] = true;
        
        // Save to localStorage and update analysis
        saveToLocalStorage();
        updateEvidenceAnalysis();
        updateProgress();
    }

    function updateEvidenceAnalysis() {
        const analyzer = new EvidenceAnalyzer();
        const analysis = analyzer.analyzeEvidenceStrength(uploadedDocs, caseData);
        
        // Update strength bar
        const strengthBar = document.getElementById('evidenceStrengthBar');
        const strengthText = document.getElementById('evidenceStrengthText');
        
        strengthBar.style.width = analysis.strength + '%';
        strengthText.textContent = `Evidence Strength: ${analysis.strength}% (${analysis.score})`;
        
        // Color code the strength bar
        if (analysis.strength >= 80) {
            strengthBar.style.background = 'linear-gradient(45deg, #4caf50, #8bc34a)';
        } else if (analysis.strength >= 60) {
            strengthBar.style.background = 'linear-gradient(45deg, #ff9800, #ffc107)';
        } else {
            strengthBar.style.background = 'linear-gradient(45deg, #f44336, #e91e63)';
        }
        
        // Show missing required documents
        const missingDiv = document.getElementById('missingRequired');
        const missingList = document.getElementById('missingRequiredList');
        
        if (analysis.missingRequired.length > 0) {
            missingList.innerHTML = analysis.missingRequired.map(doc => 
                `<div class="alert" style="background: #ffebee; border-left-color: #c62828; margin: 5px 0;">• ${doc}</div>`
            ).join('');
            missingDiv.style.display = 'block';
        } else {
            missingDiv.style.display = 'none';
        }
        
        // Show recommendations
        const recommendationsList = document.getElementById('recommendationsList');
        if (analysis.recommendations.length > 0) {
            recommendationsList.innerHTML = analysis.recommendations.map(rec => 
                `<div class="alert" style="margin: 5px 0;">
                    <strong>${rec.name}:</strong> ${rec.text}
                </div>`
            ).join('');
        } else {
            recommendationsList.innerHTML = '<div class="alert">Your evidence is complete! Consider gathering additional supporting documentation to strengthen your case further.</div>';
        }
    }

    function updateAllAnalysis() {
        updateProgress();
        updateEvidenceAnalysis();
        if (caseData.monthlyIncome && caseData.currentRent && caseData.proposedRent) {
            performFinancialAnalysis();
        }
    }

    function addTimelineEvent() {
        const date = document.getElementById('eventDate').value;
        const description = document.getElementById('eventDescription').value;
        
        if (!date || !description) {
            alert('Please fill in both date and description');
            return;
        }
        
        timelineEvents.push({
            date: date,
            description: description
        });
        
        // Sort events by date
        timelineEvents.sort((a, b) => new Date(a.date) - new Date(b.date));
        
        renderTimeline();
        
        // Clear form
        document.getElementById('eventDate').value = '';
        document.getElementById('eventDescription').value = '';
        
        // Save to localStorage
        saveToLocalStorage();
        updateProgress();
    }

    function renderTimeline() {
        const container = document.getElementById('timelineContainer');
        container.innerHTML = '';
        
        timelineEvents.forEach((event, index) => {
            const eventElement = document.createElement('div');
            eventElement.className = 'timeline-item';
            eventElement.innerHTML = `
                <strong>${new Date(event.date).toLocaleDateString()}</strong>
                <p>${event.description}</p>
                <button class="btn" onclick="removeTimelineEvent(${index})" style="background: #dc3545; margin-top: 10px;">Remove</button>
            `;
            container.appendChild(eventElement);
        });
    }

    function removeTimelineEvent(index) {
        timelineEvents.splice(index, 1);
        renderTimeline();
        saveToLocalStorage();
        updateProgress();
    }

    function generateComplaint() {
        const summary = document.getElementById('complaintSummary').value;
        const rentIncrease = document.getElementById('rentIncrease').value;
        const whyExcessive = document.getElementById('whyExcessive').value;
        const reliefSought = document.getElementById('reliefSought').value;
        
        if (!summary || !rentIncrease || !whyExcessive || !reliefSought) {
            alert('Please fill in all complaint fields');
            return;
        }

        // Save complaint data
        caseData.complaintSummary = summary;
        caseData.rentIncrease = rentIncrease;
        caseData.whyExcessive = whyExcessive;
        caseData.reliefSought = reliefSought;
        
        // Include financial hardship analysis in complaint if available
        let hardshipSection = '';
        if (caseData.monthlyIncome && caseData.currentRent && caseData.proposedRent) {
            const analyzer = new FinancialHardshipAnalyzer(caseData);
            const analysis = analyzer.calculateHardship();
            if (analysis) {
                hardshipSection = `
                    <h5>FINANCIAL HARDSHIP ANALYSIS:</h5>
                    <p>Current rent burden: ${analysis.currentBurden}% of household income</p>
                    <p>Proposed rent burden: ${analysis.proposedBurden}% of household income</p>
                    <p>Annual rent increase: $${analysis.annualIncrease.toLocaleString()} (${analysis.increasePercent}% increase)</p>
                    <p>Displacement risk: ${analysis.displacementRisk}</p>
                    ${analysis.exceedsAffordable ? '<p><strong>This rent increase would exceed HUD affordability standards (30% of income).</strong></p>' : ''}
                `;
            }
        }
        
        const complaintText = `
            <h4>FAIR RENT COMMISSION COMPLAINT</h4>
            <p><strong>Tenant:</strong> ${caseData.tenantName || '[Your Name]'}</p>
            <p><strong>Property Address:</strong> ${caseData.propertyAddress || '[Property Address]'}</p>
            <p><strong>Landlord:</strong> ${caseData.landlordName || '[Landlord Name]'}</p>
            <p><strong>Current Rent:</strong> $${caseData.currentRent || '[Current Rent]'}</p>
            <p><strong>Proposed Rent:</strong> $${caseData.proposedRent || '[Proposed Rent]'}</p>
            <p><strong>Increase Date:</strong> ${caseData.rentIncreaseDate || '[Date]'}</p>
            
            <h5>COMPLAINT SUMMARY:</h5>
            <p>${summary}</p>
            
            <h5>RENT INCREASE DETAILS:</h5>
            <p>${rentIncrease}</p>
            
            <h5>WHY THE INCREASE IS EXCESSIVE:</h5>
            <p>${whyExcessive}</p>
            
            ${hardshipSection}
            
            <h5>RELIEF SOUGHT:</h5>
            <p>${reliefSought}</p>
            
            <p><strong>Date:</strong> ${new Date().toLocaleDateString()}</p>
            <p><strong>Signature:</strong> _________________________</p>
        `;
        
        document.getElementById('complaintText').innerHTML = complaintText;
        document.getElementById('complaintOutput').style.display = 'block';
        
        saveToLocalStorage();
        updateProgress();
        showSection('preparation'); // Auto-advance to preparation
    }

    function printComplaint() {
        const printWindow = window.open('', '_blank');
        printWindow.document.write(`
            <html>
                <head>
                    <title>Fair Rent Commission Complaint</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; }
                        h4, h5 { color: #333; }
                        p { margin: 10px 0; }
                    </style>
                </head>
                <body>
                    ${document.getElementById('complaintText').innerHTML}
                </body>
            </html>
        `);
        printWindow.print();
    }

    function saveHearingPrep() {
        const openingStatement = document.getElementById('openingStatement').value;
        
        if (openingStatement) {
            caseData.openingStatement = openingStatement;
            saveToLocalStorage();
            alert('Hearing preparation saved successfully!');
            updateProgress();
            showSection('report'); // Auto-advance to report
        } else {
            alert('Please add some content before saving');
        }
    }

    function generateCaseReport() {
        const reportTitle = document.getElementById('reportTitle').value;
        const reportSummary = document.getElementById('reportSummary').value;

        if (!reportTitle || !reportSummary) {
            alert('Please fill in both report title and summary');
            return;
        }

        // Save report data
        caseData.reportTitle = reportTitle;
        caseData.reportSummary = reportSummary;

        // Include evidence analysis
        const evidenceAnalyzer = new EvidenceAnalyzer();
        const evidenceAnalysis = evidenceAnalyzer.analyzeEvidenceStrength(uploadedDocs, caseData);

        // Include financial analysis if available
        let financialSection = '';
        if (caseData.monthlyIncome && caseData.currentRent && caseData.proposedRent) {
            const analyzer = new FinancialHardshipAnalyzer(caseData);
            const analysis = analyzer.calculateHardship();
            if (analysis) {
                financialSection = `
                    <h5>Financial Hardship Analysis:</h5>
                    <p><strong>Current Rent Burden:</strong> ${analysis.currentBurden}% of income</p>
                    <p><strong>Proposed Rent Burden:</strong> ${analysis.proposedBurden}% of income</p>
                    <p><strong>Rent Increase:</strong> $${analysis.annualIncrease.toLocaleString()} annually (${analysis.increasePercent}%)</p>
                    <p><strong>Displacement Risk:</strong> ${analysis.displacementRisk}</p>
                `;
            }
        }

        const reportText = `
            <h4>${reportTitle}</h4>
            <p>${reportSummary}</p>
            
            <h5>Case Details:</h5>
            <p><strong>Tenant:</strong> ${caseData.tenantName || '[Your Name]'}</p>
            <p><strong>Property Address:</strong> ${caseData.propertyAddress || '[Property Address]'}</p>
            <p><strong>Landlord:</strong> ${caseData.landlordName || '[Landlord Name]'}</p>
            <p><strong>Current Rent:</strong> $${caseData.currentRent || '[Current Rent]'}</p>
            <p><strong>Proposed Rent:</strong> $${caseData.proposedRent || '[Proposed Rent]'}</p>
            <p><strong>Increase Date:</strong> ${caseData.rentIncreaseDate || '[Date]'}</p>
            <p><strong>Case Type:</strong> ${caseData.caseType || '[Case Type]'}</p>

            <h5>Evidence Strength Analysis:</h5>
            <p><strong>Evidence Score:</strong> ${evidenceAnalysis.strength}% (${evidenceAnalysis.score})</p>
            ${evidenceAnalysis.missingRequired.length > 0 ? 
                `<p><strong>Missing Required Documents:</strong> ${evidenceAnalysis.missingRequired.join(', ')}</p>` : 
                '<p><strong>All required documents collected</strong></p>'
            }

            ${financialSection}

            <h5>Timeline of Events:</h5>
            ${timelineEvents.length > 0 ? timelineEvents.map(event => `
                <p><strong>${new Date(event.date).toLocaleDateString()}:</strong> ${event.description}</p>
            `).join('') : '<p>No timeline events recorded</p>'}

            <h5>Uploaded Documents:</h5>
            ${Object.keys(uploadedDocs).length > 0 ? Object.keys(uploadedDocs).map(doc => `
                <p>• ${doc.charAt(0).toUpperCase() + doc.slice(1).replace(/([A-Z])/g, ' $1')}</p>
            `).join('') : '<p>No documents uploaded</p>'}

            <h5>Generated Complaint:</h5>
            ${document.getElementById('complaintOutput').style.display === 'block' ? 
                'Complaint form has been generated and is ready for submission.' : 
                'Complaint form not yet generated.'
            }

            <h5>Hearing Preparation:</h5>
            ${caseData.openingStatement ? 
                `<p>Opening statement prepared: "${caseData.openingStatement.substring(0, 100)}..."</p>` : 
                '<p>Opening statement not yet prepared.</p>'
            }
        `;

        document.getElementById('caseReportText').innerHTML = reportText;
        document.getElementById('caseReportOutput').style.display = 'block';
        
        saveToLocalStorage();
        updateProgress();
    }

    function printCaseReport() {
        const printWindow = window.open('', '_blank');
        printWindow.document.write(`
            <html>
                <head>
                    <title>Fair Rent Commission Case Report</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; }
                        h4, h5 { color: #333; }
                        p { margin: 10px 0; }
                    </style>
                </head>
                <body>
                    ${document.getElementById('caseReportText').innerHTML}
                </body>
            </html>
        `);
        printWindow.print();
    }

    function updateProgress() {
        let completedItems = 0;
        let totalItems = 7;
        
        // Check if basics are filled (including financial info)
        if (caseData.tenantName && caseData.propertyAddress && caseData.currentRent && caseData.proposedRent) {
            completedItems++;
        }
        
        // Check if required documents are uploaded
        const requiredDocs = ['lease', 'notice', 'payments'];
        const hasRequiredDocs = requiredDocs.every(doc => uploadedDocs[doc]);
        if (hasRequiredDocs) {
            completedItems++;
        }
        
        // Check if timeline has events
        if (timelineEvents.length > 0) {
            completedItems++;
        }
        
        // Check if complaint is generated
        if (document.getElementById('complaintOutput').style.display === 'block') {
            completedItems++;
        }
        
        // Check if hearing prep is done
        if (caseData.openingStatement) {
            completedItems++;
        }

        // Check if report is generated
        if (document.getElementById('caseReportOutput').style.display === 'block') {
            completedItems++;
        }
        
        // Resources section is always available
        completedItems++; // Always count resources as complete
        
        const progressPercent = Math.round((completedItems / totalItems) * 100);
        document.getElementById('progressBar').style.width = progressPercent + '%';
        document.getElementById('progressText').textContent = progressPercent + '% Complete';
    }

    // Clear all data function
    function clearAllData() {
        if (confirm('Are you sure you want to clear all case data? This cannot be undone.')) {
            localStorage.removeItem('frcCaseData');
            location.reload();
        }
    }

    // Add real-time saving for form inputs
    function setupAutoSave() {
        const inputs = ['tenantName', 'propertyAddress', 'landlordName', 'currentRent', 'proposedRent', 'rentIncreaseDate', 'caseType', 'monthlyIncome', 'monthlyExpenses', 'householdSize'];
        
        inputs.forEach(inputId => {
            const element = document.getElementById(inputId);
            if (element) {
                element.addEventListener('input', function() {
                    caseData[inputId] = this.value;
                    saveToLocalStorage();
                    
                    // Update financial analysis in real-time if relevant fields change
                    if (['monthlyIncome', 'currentRent', 'proposedRent', 'monthlyExpenses'].includes(inputId)) {
                        if (caseData.monthlyIncome && caseData.currentRent && caseData.proposedRent) {
                            performFinancialAnalysis();
                        }
                    }
                });
            }
        });

        // Auto-save textarea fields
        const textareas = ['complaintSummary', 'rentIncrease', 'whyExcessive', 'reliefSought', 'openingStatement', 'reportTitle', 'reportSummary'];
        textareas.forEach(textareaId => {
            const element = document.getElementById(textareaId);
            if (element) {
                element.addEventListener('input', function() {
                    caseData[textareaId] = this.value;
                    saveToLocalStorage();
                });
            }
        });
    }

    // Add a save indicator
    function showSaveIndicator() {
        const indicator = document.createElement('div');
        indicator.id = 'saveIndicator';
        indicator.innerHTML = '✓ Data saved automatically';
        indicator.style.cssText = 'position: fixed; top: 20px; right: 20px; background: #4caf50; color: white; padding: 10px 15px; border-radius: 5px; z-index: 1000; opacity: 0; transition: opacity 0.3s;';
        document.body.appendChild(indicator);
        
        // Show and hide the indicator
        setTimeout(() => indicator.style.opacity = '1', 100);
        setTimeout(() => indicator.style.opacity = '0', 2000);
        setTimeout(() => document.body.removeChild(indicator), 2500);
    }

    // Override saveToLocalStorage to show indicator
    const originalSaveToLocalStorage = saveToLocalStorage;
    saveToLocalStorage = function() {
        originalSaveToLocalStorage();
        showSaveIndicator();
    };

    // Initialize the application
    document.addEventListener('DOMContentLoaded', function() {
        loadFromLocalStorage();
        setupAutoSave();
        updateAllAnalysis();
        
        // Add clear data button to sidebar
        const clearButton = document.createElement('button');
        clearButton.textContent = 'Clear All Data';
        clearButton.className = 'btn';
        clearButton.style.cssText = 'background: #dc3545; margin-top: 20px; width: 100%;';
        clearButton.onclick = clearAllData;
        document.querySelector('.sidebar').appendChild(clearButton);
        
        console.log('FRC Case Prep Tool v2.0 loaded with Phase 1 improvements:');
        console.log('✓ Data persistence with localStorage');
        console.log('✓ Evidence strength analysis');
        console.log('✓ Financial hardship analysis');
        console.log('✓ Auto-save functionality');
    });
</script>
```

</body>
</html>
